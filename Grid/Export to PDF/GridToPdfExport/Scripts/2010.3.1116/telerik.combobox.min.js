(function(a){var b=a.telerik;b.combobox=function(c,d){a.extend(this,d);var e=a(c);this.element=c;this.$element=e;this.loader=new b.list.loader(this);this.trigger=new b.list.trigger(this);var g=this.$text=e.find("> .t-dropdown-wrap > .t-input").attr("autocomplete","off");var f=e.find("> .t-dropdown-wrap > .t-select");var k=a.browser.msie?"propertychange":"DOMAttrModified";var i=this.$input=this.$element.find("input:last").bind(k,function(p){var n="class",o=i.attr(n);if(o!=g.attr(n)){g.attr(n,o).addClass("t-input")}});if(!i.attr("disabled")){f.bind("click",a.proxy(m,this))}this.filtering=new b.list.filtering(this);this.filtering.autoFill=function(n,o){if(n.autoFill&&(n.lastKeyCode!=8&&n.lastKeyCode!=46)){var p=n.$text[0];var t=b.caretPos(p);var s=p.value.substring(0,t);var r=o.toLowerCase().indexOf(s.toLowerCase());if(r!=-1){var q=o.substring(r+s.length);p.value=s+q;b.list.selection(p,t,t+q.length)}}};this.dropDown=new b.dropDown({attr:this.dropDownAttr,effects:this.effects,onOpen:a.proxy(function(){var o=this.data;var n=this.dropDown;if(o.length==0){return}var q=this.$text.val();var p=this.selectedIndex;if(p!=-1&&this.isFiltered){if(q==o[p].Text){this.filteredDataIndexes=[];n.onItemCreate=null;n.dataBind(this.data);this.select(n.$items[p])}else{this.filters[this.filter](this,this.data,q)}this.isFiltered=false}},this),onClick:a.proxy(function(n){this.select(n.item);this.trigger.change();this.trigger.close()},this)});this.dropDown.$element.css("direction",e.closest(".t-rtl").length?"rtl":"");this.enable=function(){e.removeClass("t-state-disabled").find(".t-input").removeAttr("disabled");f.bind("click",a.proxy(m,this))};this.disable=function(){e.addClass("t-state-disabled").find(".t-input").attr("disabled","disabled");f.unbind("click")};this.fill=function(o){function q(w){var v=w.value();if(v){w.select(function(C){return v==(C.Value||C.Text)});return}var x=n.$items;var z=w.index;var y=x.filter(".t-state-selected");var A=y.length;var B=z!=-1&&z<x.length?x[z]:A>0?y[A-1]:null;if(B){w.select(B)}else{w.selectedIndex=-1;if(w.highlightFirst){w.highlight(x[0])}}}var r=this.loader;var n=this.dropDown;var t=this.minChars;var s=this.text();var p=s.length;if(!n.$items&&!r.ajaxError){if(r.isAjax()&&p>=t){var u={};u[this.queryString.text]=s;r.ajaxRequest(function(v){this.data=v;this.dataBind(v,true);q(this);b.trigger(this.element,"dataBound");this.trigger.change();if(o){o()}},{data:u})}else{this.dataBind(this.data,true);q(this);if(o){o()}}}};this.reload=function(){this.dropDown.$items=null;this.fill()};this.select=function(o){var n=this.highlight(o);if(n==-1){return n}var p=this.filteredDataIndexes;this.selectedIndex=(p&&p.length)>0?p[n]:n;b.list.updateTextAndValue(this,a(this.dropDown.$items[n]).text(),this.data[this.selectedIndex].Value)};this.text=function(){return this.$text.val.apply(this.$text,arguments)};this.value=function(){if(arguments.length){var o=arguments[0];var n=this.select(function(p){return o==p.Value});if(n==-1){this.$input.val(o);this.text(o)}this.previousValue=this.$input.val()}else{return this.$input.val()}};b.list.common.call(this);b.list.filters.call(this);b.list.initialize.call(this);this.$text.bind({change:a.proxy(function(n){n.stopPropagation()},this),keydown:a.proxy(j,this),keypress:a.proxy(h,this),focus:a.proxy(function(q){var o=this.trigger;var n=this.dropDown;if(!n.$items){this.fill(o.open)}else{o.open()}var p=this.$text;b.list.selection(p[0],0,p.val().length)},this)});function m(n){this.loader.ajaxError=false;if(!this.dropDown.isOpened()){this.$text[0].focus()}else{this.trigger.close()}}function l(n){clearTimeout(n.timeout);n.timeout=setTimeout(function(){n.filtering.filter(n)},n.delay)}function j(v){var q=this.trigger;var o=this.dropDown;var s=v.keyCode||v.which;this.lastKeyCode=s;if(v.altKey&&s==38){q.close();return}if(v.altKey&&s==40){q.open();return}if(!v.shiftKey&&(s==38||s==40)){v.preventDefault();if(!o.$items){this.fill()}var p=o.$items;var t=p.filter(".t-state-selected:first");var n=t.length==0||p.length==1?p.first():(s==38)?t.prev():(s==40)?t.next():[];if(n.length){var w=n[0];this.select(w);o.scrollTo(w);if(!o.isOpened()){q.change()}}}if(s==8||s==46){var r=this.$text;if(r.val()!=""){l(this)}setTimeout(a.proxy(function(){if(r.val()==""){this.selectedIndex=-1;this.$input.val("")}else{this.$input.val(this.$text.val())}},this),0)}if(s==13){if(o.isOpened()){v.preventDefault()}var u=o.$items.filter(".t-state-selected:first");if(u.length>0){this.select(u[0])}else{this.$input.val(this.$text.val())}q.change();q.close();b.list.moveToEnd(this.$text[0])}if(s==27||s==9){q.change();q.close();if(s==27){this.$text.blur()}}}function h(o){var n=o.keyCode||o.charCode;if(n==0||a.inArray(n,b.list.keycodes)!=-1){return true}setTimeout(a.proxy(function(){this.$input.val(this.$text.val())},this),0);l(this)}};a.fn.tComboBox=function(c){return b.create(this,{name:"tComboBox",init:function(d,e){return new b.combobox(d,e)},options:c})};a.fn.tComboBox.defaults={effects:b.fx.slide.defaults(),index:-1,autoFill:true,highlightFirst:true,filter:0,delay:200,minChars:0,cache:true,queryString:{text:"text"}}})(jQuery);